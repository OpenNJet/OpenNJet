
njt_addon_name=njt_http_modsecurity_module

# We must place njt_http_modsecurity_module after njt_http_gzip_filter_module
# in load order list to be able to read response body before it gets compressed
# (for filter modules later initialization means earlier execution).
#
# Nginx implements load ordering only for dynamic modules and only a BEFORE part
# of "njt_module_order". So we list all of the modules that come after
# njt_http_gzip_filter_module as a BEFORE dependency for
# njt_http_modsecurity_module.
#
# For static compilation HTTP_FILTER_MODULES will be patched later.

modsecurity_dependency="njt_http_postpone_filter_module \
                        njt_http_ssi_filter_module \
                        njt_http_charset_filter_module \
                        njt_http_xslt_filter_module \
                        njt_http_image_filter_module \
                        njt_http_sub_filter_module \
                        njt_http_addition_filter_module \
                        njt_http_gunzip_filter_module \
                        njt_http_userid_filter_module \
                        njt_http_headers_filter_module \
                        njt_http_copy_filter_module"


njt_module_type=HTTP_FILTER
njt_module_name="$njt_addon_name"
njt_module_srcs="$njt_addon_dir/src/njt_http_modsecurity_module.c \
            $njt_addon_dir/src/njt_http_modsecurity_pre_access.c \
            $njt_addon_dir/src/njt_http_modsecurity_header_filter.c \
            $njt_addon_dir/src/njt_http_modsecurity_body_filter.c \
            $njt_addon_dir/src/njt_http_modsecurity_log.c \
            $njt_addon_dir/src/njt_http_modsecurity_rewrite.c \
            "
njt_module_deps="$njt_addon_dir/src/ddebug.h \
            $njt_addon_dir/src/njt_http_modsecurity_common.h \
            "
njt_module_incs="$njt_addon_dir/../../auto/lib/modsecurity/headers"
njt_module_libs="-L$njt_addon_dir/../../auto/lib/modsecurity/src/.libs/ -lmodsecurity"

njt_module_order="njt_http_chunked_filter_module \
                          njt_http_v2_filter_module \
                          njt_http_range_header_filter_module \
                          njt_http_gzip_filter_module \
                          $njt_module_name \
                          $modsecurity_dependency";

. auto/module

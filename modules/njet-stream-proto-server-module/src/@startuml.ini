@startuml
hide footbox
actor operator as o
participant "worker1" as w1
participant "proto_server模块" as proxy
participant "mqtt" as s
participant "worker2" as w2
participant "worker...n" as wn
actor operator as other





o->w1: connect 请求: 
activate w1
w1->proxy: 处理connect 请求
proxy->proxy:分配uuid1={workid+流水id+[ip+port]}
proxy->proxy:保存到server共享内存
o->w1: 客户列表查询
w1->proxy: 处理列表查询
proxy->o: 返回列表查询 [uuid1,uuid2,uuid3]
o->w1: 发送消息给uuid2
w1->proxy: 处理消息发送
alt 在本worker1
    proxy->other: 发送消息给
else 在worker2
    proxy->s: mqtt消息= {port+server_name + uuid2 + content[uuid1]}
    s->w2:转发mqtt 消息到worker2
    w2->other: 发送content 到uuid2
end
o->w1: 发送广播消息
w1->proxy: 处理广播消息
proxy->s:发送mqtt 消息到mqtt
s->w2:转发mqtt 消息到worker2
s->wn:转发mqtt 消息到workern
s->w1:转发mqtt 消息到worker1
w1->o: 发送到客户端
@enduml